#!/usr/bin/env python3
import sys
import os

# CRITICAL: Set the working directory to the project directory FIRST
project_dir = '/home/pi/noaa_alerts_system'

# Ensure the project directory exists
if not os.path.exists(project_dir):
    raise RuntimeError(f"Project directory does not exist: {project_dir}")

# Change to the project directory
os.chdir(project_dir)

# Verify we're in the right directory
current_dir = os.getcwd()
if current_dir != project_dir:
    raise RuntimeError(f"Failed to change directory. Current: {current_dir}, Expected: {project_dir}")

# Add project directory to Python path
if project_dir not in sys.path:
    sys.path.insert(0, project_dir)

# Now import the Flask application
try:
    from app import app
except ImportError as e:
    raise ImportError(f"Could not import Flask app from {project_dir}: {e}")

# WSGI application object
application = app

# Add some debugging info to the app context
with app.app_context():
    app.logger.info(f"WSGI startup - Working directory: {os.getcwd()}")
    app.logger.info(f"WSGI startup - Template folder: {app.template_folder}")
    app.logger.info(f"WSGI startup - Template folder exists: {os.path.exists(app.template_folder)}")

if __name__ == "__main__":
    application.run(debug=False, host='0.0.0.0', port=5000)