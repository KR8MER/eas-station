<!DOCTYPE html>
<html lang="en" data-theme="cosmo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}EAS Station - Emergency Alert System{% endblock %}</title>
    {% block nav_title %}{% endblock %}

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/eas-system-wordmark.svg') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/eas-system-wordmark.svg') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/eas-system-wordmark.svg') }}">
    <link rel="mask-icon" href="{{ url_for('static', filename='img/eas-system-wordmark.svg') }}" color="#204885">
    <meta name="theme-color" content="#204885">

    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- EAS Station Stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive-enhancements.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/loading-states.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/error-handling.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/accessibility.css') }}">

    <script>
        window.CSRF_TOKEN = {{ csrf_token | tojson }};
        (function() {
            const originalFetch = window.fetch;
            window.fetch = function(input, init) {
                init = init || {};
                const method = (init.method || 'GET').toUpperCase();
                if (['POST', 'PUT', 'PATCH', 'DELETE'].includes(method)) {
                    const headers = new Headers(init.headers || {});
                    if (window.CSRF_TOKEN && !headers.has('X-CSRF-Token')) {
                        headers.set('X-CSRF-Token', window.CSRF_TOKEN);
                    }
                    init.headers = headers;
                }
                return originalFetch.call(this, input, init);
            };
        })();
    </script>

    {% if location_settings %}
    <script>
        window.APP_LOCATION = {{ location_settings | tojson }};
    </script>
    {% endif %}

    {% if boundary_type_config %}
    <script>
        window.BOUNDARY_TYPE_CONFIG = {{ boundary_type_config | tojson }};
        window.BOUNDARY_GROUP_LABELS = {{ boundary_group_labels | tojson }};
    </script>
    {% endif %}


    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- Navigation -->
    {% include 'components/navbar.html' %}


    <div id="system-status-banner" class="system-status-banner alert alert-warning d-none" role="alert" aria-live="polite">
        <div class="banner-content">
            <i class="fas fa-triangle-exclamation banner-icon"></i>
            <div class="banner-message">
                <span class="banner-title" id="system-status-banner-title">System Warning</span>
                <span class="banner-text" id="system-status-banner-text">System status updates will appear here.</span>
            </div>
        </div>
        <button type="button" class="btn-close" id="system-status-banner-close" aria-label="Dismiss system status alert"></button>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="container-fluid mt-3">
                {% for message in messages %}
                    <div class="alert alert-info alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container-fluid">
            <div class="footer-content">
                <div class="row align-items-center gy-3 text-center text-lg-start">
                    <div class="col-12 col-lg-4">
                        <div class="footer-meta">
                            <div class="footer-brand">
                                <i class="fas fa-broadcast-tower me-2"></i>© 2025 Timothy Kramer (KR8MER)
                            </div>
                            <div class="footer-subtext">
                                <i class="fas fa-shield-alt me-2"></i>EAS Station · Emergency Alert System Research Platform
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-4">
                        <div class="footer-clock d-flex justify-content-center">
                            <div class="d-inline-flex align-items-center justify-content-center gap-2">
                                <i class="fas fa-clock"></i>
                                <span id="current-time">Loading...</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-4">
                        <div class="footer-version text-uppercase fw-semibold text-center text-lg-end">
                            Version {{ system_version }}
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer-links">
                <a href="{{ url_for('terms_page') }}"><i class="fas fa-file-contract me-1"></i>Terms of Use</a>
                <span class="text-muted">•</span>
                <a href="{{ url_for('privacy_page') }}"><i class="fas fa-user-lock me-1"></i>Privacy Policy</a>
                <span class="text-muted">•</span>
                <a href="{{ url_for('help_page') }}"><i class="fas fa-life-ring me-1"></i>Help Center</a>
            </div>

            <!-- Tech Stack Badges -->
            {% set icecast_logo = shield_logos.get('icecast') %}
            {% set soapysdr_logo = shield_logos.get('soapysdr') %}
            {% set commit_value = git_commit | default('', true) %}
            {% set commit_label = commit_value %}
            {% if not commit_label or commit_label|lower == 'unknown' %}
                {% set commit_label = 'dev build' %}
            {% endif %}
            {% set commit_badge_text = commit_label | upper %}
            {% set commit_badge_encoded = commit_badge_text | shields_escape %}
            <div class="tech-stack-badges d-flex flex-wrap justify-content-center align-items-center gap-2 my-3">
                <img src="https://img.shields.io/badge/Git%20Commit-{{ commit_badge_encoded }}-181717?style=flat-square&logo=github&logoColor=white" alt="Git commit {{ commit_badge_text }}" height="20">
                <img src="https://img.shields.io/badge/Python-3.11-3776AB?style=flat-square&logo=python&logoColor=white" alt="Python 3.11" height="20">
                <img src="https://img.shields.io/badge/Flask-3.0-000000?style=flat-square&logo=flask&logoColor=white" alt="Flask 3.0" height="20">
                <img src="https://img.shields.io/badge/SQLAlchemy-2.0-CA2C39?style=flat-square&logo=sqlalchemy&logoColor=white" alt="SQLAlchemy 2.0" height="20">
                <img src="https://img.shields.io/badge/PostgreSQL%20%2B%20PostGIS-17%20%2F%203.4-0093D0?style=flat-square&logo=postgresql&logoColor=white" alt="PostgreSQL 17 with PostGIS 3.4" height="20">
                <img src="https://img.shields.io/badge/Gunicorn-23.0-499848?style=flat-square&logo=gunicorn&logoColor=white" alt="Gunicorn 23.0" height="20">
                <img src="https://img.shields.io/badge/Nginx-1.26-009639?style=flat-square&logo=nginx&logoColor=white" alt="Nginx 1.26" height="20">
                <img src="https://img.shields.io/badge/Icecast-2.4.4-1F3B73?style=flat-square{% if icecast_logo %}&logo={{ icecast_logo | urlencode }}{% endif %}" alt="Icecast 2.4.4" height="20">
                <img src="https://img.shields.io/badge/Docker%20Compose-v2-2496ED?style=flat-square&logo=docker&logoColor=white" alt="Docker Compose v2" height="20">
                <img src="https://img.shields.io/badge/Bootstrap-5.3-7952B3?style=flat-square&logo=bootstrap&logoColor=white" alt="Bootstrap 5.3" height="20">
                <img src="https://img.shields.io/badge/Font%20Awesome-6.4-528DD7?style=flat-square&logo=fontawesome&logoColor=white" alt="Font Awesome 6.4" height="20">
                <img src="https://img.shields.io/badge/Leaflet-1.9.4-199900?style=flat-square&logo=leaflet&logoColor=white" alt="Leaflet 1.9.4" height="20">
                <img src="https://img.shields.io/badge/SoapySDR-enabled-FF6600?style=flat-square{% if soapysdr_logo %}&logo={{ soapysdr_logo | urlencode }}{% endif %}" alt="SoapySDR enabled" height="20">
            </div>

            <p class="footer-disclaimer mb-0">
                <strong>For research and training use only.</strong> Experimental development platform without FCC certification,
                not for production deployments, and absolutely never for life-safety or emergency response decisions.
            </p>
        </div>
    </footer>

    <!-- SCRIPTS - Load order is important! -->
    <!-- 1. Bootstrap first -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <!-- 2. EAS Station Core JavaScript Modules -->
    <script src="{{ url_for('static', filename='js/core/theme.js') }}"></script>
    <script src="{{ url_for('static', filename='js/core/notifications.js') }}"></script>
    <script src="{{ url_for('static', filename='js/core/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/core/health.js') }}"></script>
    <script src="{{ url_for('static', filename='js/core/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/loading-error-utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/accessibility-utils.js') }}"></script>

    <!-- 3. Page-specific scripts -->
    {% block scripts %}{% endblock %}
</body>
</html>
