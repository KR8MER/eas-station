FROM nginx:alpine

# Install required tools for certificate handling and envsubst
RUN apk add --no-cache \
    openssl \
    gettext \
    bash

# Create necessary directories
RUN mkdir -p /var/www/certbot /etc/nginx/conf.d

# Copy initialization script
COPY nginx-init.sh /docker-entrypoint.d/00-init.sh
RUN chmod +x /docker-entrypoint.d/00-init.sh

# Copy nginx configuration template
COPY nginx.conf /etc/nginx/nginx.conf.template

EXPOSE 80 443

CMD ["/docker-entrypoint.d/00-init.sh"]
