# NOTE: This file is DEPRECATED
#
# Icecast is now integrated into the main docker-compose.yml by default.
# All EAS Station deployments include Icecast streaming automatically.
#
# To use Icecast:
#   1. Start the full stack: docker-compose up -d
#   2. Icecast will be available at http://localhost:8001
#   3. Configure audio streaming in the web UI: /settings/audio
#
# If you want to run ONLY Icecast for testing, use this minimal configuration:

version: '3.8'

services:
  icecast:
    build:
      context: .
      dockerfile: Dockerfile.icecast
    image: eas-icecast:latest
    container_name: eas-icecast
    restart: unless-stopped
    ports:
      - "${ICECAST_PORT:-8001}:8000"  # Icecast web interface and streams
    environment:
      # Icecast configuration via environment variables
      - ICECAST_LOCATION=EAS Monitoring Station
      - ICECAST_ADMIN=${ICECAST_CONTACT:-admin@example.com}
      - ICECAST_HOSTNAME=${ICECAST_HOSTNAME:-}
      - ICECAST_PUBLIC_HOSTNAME=${ICECAST_PUBLIC_HOSTNAME:-}
      - ICECAST_MAX_CLIENTS=${ICECAST_MAX_CLIENTS:-100}
      - ICECAST_MAX_SOURCES=${ICECAST_MAX_SOURCES:-50}

      # Authentication (defaults only - CHANGE THESE!)
      - ICECAST_SOURCE_PASSWORD=${ICECAST_SOURCE_PASSWORD:-eas_station_source_password}
      - ICECAST_RELAY_PASSWORD=${ICECAST_RELAY_PASSWORD:-changeme_relay}
      - ICECAST_ADMIN_PASSWORD=${ICECAST_ADMIN_PASSWORD:-changeme_admin}
    volumes:
      - icecast-logs:/var/log/icecast2
    healthcheck:
      test: ["CMD-SHELL", "curl -f -s http://localhost:8000/status.xsl >/dev/null || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s

volumes:
  icecast-logs:

# USAGE:
# 1. Start Icecast server:
#    docker-compose -f docker-compose.icecast.yml up -d
#
# 2. Access Icecast admin interface:
#    http://localhost:8001/admin/
#    Username: admin
#    Password: changeme_admin  (CHANGE THIS!)
#
# 3. Configure EAS Station to use Icecast:
#    - Point to: localhost:8001
#    - Source Password: eas_station_source_password (must match above)
#
# 4. Stop Icecast:
#    docker-compose -f docker-compose.icecast.yml down
#
# RECOMMENDED: Use the main docker-compose.yml instead, which includes
# Icecast as part of the integrated EAS Station stack.
