# Google Search Console Integration Runbook

This runbook explains how to publish crawler-friendly metadata (robots.txt and sitemap.xml),
verify ownership in Google Search Console, and respond to the deceptive-content warnings
captured in `/bugs/Screenshot_7-11-2025_75931_easstation.com.jpeg` and the TLS
concerns illustrated in `/bugs/Screenshot_4-11-2025_202347_omv.local.jpeg`.

## 1. Preparing the application

1. **Expose the sitemap** – `/sitemap.xml` is generated by `webapp/routes_public.py` and
   now lists the primary public pages plus the newest CAP alert detail pages (via the
   `/alerts/<id>` route). Set the optional environment variable `SITEMAP_ALERT_LIMIT`
   when you need to cap how many alerts appear in the sitemap.
2. **Reference the sitemap from robots.txt** – `/robots.txt` automatically appends a
   `Sitemap:` line so crawlers can discover it without extra Search Console steps.
3. **Enable verification tags** – Populate the `GOOGLE_SITE_VERIFICATION` environment
   variable with the token provided by Google. The `<meta name="google-site-verification">`
   element is rendered in `templates/base.html` for every page, so Search Console can
   validate ownership without extra templates.

## 2. Verifying ownership

1. Sign in to Search Console, add the property for the production hostname
   (e.g., `https://easstation.com`).
2. Choose the **HTML tag** verification method and copy the token string (typically a
   43-character slug).
3. Set `GOOGLE_SITE_VERIFICATION="googleXXXXXXXXXXXX"` in the deployment environment and
   restart Gunicorn so Flask reloads the config.
4. Alternatively, download the HTML verification file from Google and place it inside the
   repository’s `static/` directory; Flask already serves the file at `/static/filename`.
5. Press **Verify** in Search Console after redeploying. You should see a success banner
   within a few minutes because both the meta tag and robots sitemap hint are served at
   the site root.

## 3. Submitting the sitemap and monitoring crawls

1. Visit the **Sitemaps** panel in Search Console and submit `https://<hostname>/sitemap.xml`.
2. Validate the XML locally with `curl https://<hostname>/sitemap.xml` – it should return
   HTTP 200 and list both the static navigation pages and the most recent alert detail URLs.
3. Confirm that `/robots.txt` now ends with `Sitemap: https://<hostname>/sitemap.xml` by
   running `curl https://<hostname>/robots.txt`.
4. Use the **URL Inspection** tool on a few alert detail links to confirm Google can render
   them (CAP alert detail pages are now linked directly from the sitemap).

## 4. Clearing deceptive-content warnings

Google flagged the property for “Deceptive pages” and “Possible phishing detected on user
login,” which is shown in `/bugs/Screenshot_7-11-2025_75931_easstation.com.jpeg`. To
resolve the warning:

1. Audit all `/login`, `/admin`, and other credential forms to ensure they only load over
   HTTPS and reference production asset URLs.
2. Update any wording on the login page that might mimic other brands (Google often flags
   copied strings from common providers). Ensure the footer clearly states this is an
   EAS Station research platform.
3. Capture before/after screenshots and upload them to the **Security issues** panel.
4. Submit a **Request Review** describing the changes (HTTPS-only login, updated branding,
   and now a published sitemap + robots) and mention that the site carries NOAA/NWS data.
5. Monitor the review status; the queue typically clears within 1–2 days if no malware is
   detected.

## 5. TLS certificate hygiene

The certificate modal in `/bugs/Screenshot_4-11-2025_202347_omv.local.jpeg` confirms the
site is fronted by Let’s Encrypt. Keep the warning from Search Console from reappearing by:

1. Renewing certificates at least every 60 days via the existing certbot/ACME automation.
2. Verifying that intermediate certificates are included (the screenshot shows the correct
   chain; maintain it by updating the web server bundle during renewals).
3. Running `openssl s_client -connect easstation.com:443 -servername easstation.com`
   after each renewal to confirm the issued certificate matches the hostname and that the
   SHA-256 fingerprint matches expectations.
4. Documenting renewal times in `docs/runbooks/upgrade_checklist.md` so operations staff
   can track expirations.

Following this runbook keeps Search Console happy, clears the deceptive-content banner, and
ensures the site advertises authoritative URLs through both `robots.txt` and `sitemap.xml`.
