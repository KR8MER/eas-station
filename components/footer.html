<!-- Footer Component -->
<footer class="footer">
    <div class="footer-container">
        <!-- Emergency Contact (if alerts are active) -->
        <div class="emergency-contact" id="emergency-section" style="display: none;">
            <h5><i class="fas fa-exclamation-triangle"></i> Emergency Contact</h5>
            <p class="emergency-number">Call 911</p>
            <p>For immediate weather-related emergencies</p>
        </div>

        <!-- Footer Content Grid -->
        <div class="footer-content">
            <!-- System Information -->
            <div class="footer-section">
                <h4><i class="fas fa-info-circle"></i> System Information</h4>
                <p>Real-time NOAA CAP (Common Alerting Protocol) emergency alerts and weather notifications for your area.</p>

                <div class="status-indicator">
                    <div class="status-dot" id="footer-status-dot"></div>
                    <span class="status-text" id="footer-status-text">All Systems Operational</span>
                </div>

                <div class="version-info">
                    <span>Version:</span>
                    <span class="version-badge">v{{ system_version }}</span>
                    <span>Build: {{ config.BUILD_NUMBER or '20250131' }}</span>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="footer-section">
                <h4><i class="fas fa-link"></i> Quick Navigation</h4>
                <ul class="footer-links">
                    <li><a href="{{ url_for('index') }}"><i class="fas fa-map"></i> Interactive Map</a></li>
                    <li><a href="/alerts"><i class="fas fa-history"></i> Alert History</a></li>
                    <li><a href="/stats"><i class="fas fa-chart-bar"></i> Statistics & Reports</a></li>
                    <li><a href="/admin"><i class="fas fa-cog"></i> System Administration</a></li>
                    <li><a href="/health"><i class="fas fa-heartbeat"></i> System Health Monitor</a></li>
                    <li><a href="/debug/ipaws"><i class="fas fa-bug"></i> IPAWS Debug</a></li>
                </ul>
            </div>

            <!-- Resources & Support -->
            <div class="footer-section">
                <h4><i class="fas fa-life-ring"></i> Resources & Support</h4>
                <ul class="footer-links">
                    <li><a href="https://www.weather.gov/" target="_blank"><i class="fas fa-external-link-alt"></i> National Weather Service</a></li>
                    <li><a href="https://www.ready.gov/" target="_blank"><i class="fas fa-shield-alt"></i> Ready.gov Emergency Guide</a></li>
                    <li><a href="{{ url_for('help_page') }}"><i class="fas fa-question-circle"></i> Help & Documentation</a></li>
                    <li><a href="{{ url_for('about_page') }}"><i class="fas fa-info-circle"></i> About EAS Station</a></li>
                </ul>

                <!-- Social/External Links -->
                <div class="social-links">
                    <a href="https://github.com/kr8mer" class="social-link" title="GitHub" target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="mailto:support@kr8mer.com" class="social-link" title="Email Support">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>

            <!-- System Status & Updates -->
            <div class="footer-section">
                <h4><i class="fas fa-server"></i> System Status</h4>

                <div class="contact-item">
                    <i class="fas fa-clock"></i>
                    <span>Last Updated: <span class="last-updated" id="last-update-time">--:--</span></span>
                </div>

                <div class="contact-item">
                    <i class="fas fa-database"></i>
                    <span>Active Alerts: <span id="footer-alert-count">0</span></span>
                </div>

                <div class="contact-item">
                    <i class="fas fa-signal"></i>
                    <span>Data Sources: <span id="data-source-count">3</span> Online</span>
                </div>

                <div class="contact-item">
                    <i class="fas fa-users"></i>
                    <span>Active Users: <span id="active-users">--</span></span>
                </div>

                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Coverage Area: Multi-State</span>
                </div>
            </div>
        </div>

        <!-- Footer Bottom -->
        <div class="footer-bottom">
            <div class="footer-bottom-content">
                <p class="copyright">
                    &copy; {{ moment().format('YYYY') or '2025' }} KR8MER Emergency Alert System.
                    All rights reserved.
                </p>

                <div class="footer-meta">
                    <!-- Future links for legal pages -->
                </div>
            </div>

            <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: var(--spacing-sm);">
                This system provides emergency weather alerts from NOAA.
                For life-threatening emergencies, always call 911 immediately.
            </p>
        </div>
    </div>
</footer>

<style>
/* Footer-specific styles that aren't in the main CSS */
.skip-link {
    position: absolute;
    top: -40px;
    left: 6px;
    background: var(--accent-primary);
    color: white;
    padding: 8px;
    text-decoration: none;
    border-radius: 4px;
    z-index: 1001;
}

.skip-link:focus {
    top: 6px;
}

.alert-container {
    position: fixed;
    top: 80px;
    right: 20px;
    z-index: 1000;
    max-width: 400px;
}

.alert {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-left: 4px solid var(--info);
    border-radius: var(--radius-sm);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
    box-shadow: 0 4px 12px var(--shadow);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.alert-success { border-left-color: var(--success); }
.alert-warning { border-left-color: var(--warning); }
.alert-error { border-left-color: var(--danger); }

.btn-close {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    margin-left: auto;
    padding: var(--spacing-xs);
}
</style>

<script>
// Footer functionality
document.addEventListener('DOMContentLoaded', function() {
    // Update timestamps
    updateTimestamp();
    setInterval(updateTimestamp, 60000); // Update every minute

    // Fetch system status
    updateFooterStatus();
    setInterval(updateFooterStatus, 30000); // Update every 30 seconds

    // Show emergency contact if there are active severe alerts
    checkEmergencyAlerts();
});

function updateTimestamp() {
    const timeElement = document.getElementById('last-update-time');
    if (timeElement) {
        const now = new Date();
        timeElement.textContent = now.toLocaleTimeString();
    }
}

function updateFooterStatus() {
    // Update alert count - placeholder until API is implemented
    const countElement = document.getElementById('footer-alert-count');
    if (countElement) {
        // Get count from page context if available
        countElement.textContent = '—';
    }

    // Update system status - use correct endpoint with underscore
    fetch('/api/system_status')
        .then(response => response.json())
        .then(data => {
            const dotElement = document.getElementById('footer-status-dot');
            const textElement = document.getElementById('footer-status-text');

            if (dotElement && textElement) {
                const statusKey = (data.status || '').toString().toLowerCase();
                const isHealthy = statusKey === 'healthy' || statusKey === 'online';
                dotElement.className = `status-dot ${isHealthy ? '' : 'status-warning'}`;
                textElement.textContent = data.status_summary || data.message || 'System Status Unknown';
            }

            // Active users and data sources - placeholder values
            const usersElement = document.getElementById('active-users');
            if (usersElement) usersElement.textContent = '—';

            const sourcesElement = document.getElementById('data-source-count');
            if (sourcesElement) sourcesElement.textContent = '3';
        })
        .catch(() => {
            // Handle errors gracefully
            const textElement = document.getElementById('footer-status-text');
            if (textElement) {
                textElement.textContent = 'Status Check Failed';
            }
        });
}

function checkEmergencyAlerts() {
    // Placeholder - API endpoint not yet implemented
    // Keep emergency section hidden by default
    const emergencySection = document.getElementById('emergency-section');
    if (emergencySection) {
        emergencySection.style.display = 'none';
    }
}
</script>